---
slug: /configuration
description: Velocity设计为易于配置,本指南将指导你如何进行配置。
---

# 配置Velocity

Velocity设计为易于配置和设置。所有Velocity文件都存储在`velocity.toml`中,位于你启动代理的目录中。Velocity使用[TOML](https://github.com/toml-lang/toml)文件格式,因为它易于理解,并避免了YAML和社区中其他常见配置格式的陷阱。

最新版本的默认配置可以在[GitHub](https://github.com/PaperMC/Velocity/blob/dev/3.0.0/proxy/src/main/resources/default-velocity.toml)上找到。

## 数据类型

Velocity配置中有一些"特殊"的数据类型。

### 聊天

聊天消息可以使用[MiniMessage](https://docs.advntr.dev/minimessage/format.html)格式提供。

Minecraft 1.16及更高版本支持RGB。

### 地址

地址是一个IP地址或主机名与端口的配对,用冒号(`:`)分隔。例如,`127.0.0.1:25577`和`server01.example.com:25565`是有效的地址。

## 根部分

这些设置主要涵盖代理的基本、最基本的设置。

| 设置名称                           | 类型    | 描述                                                                                                                                                                                                                                                        |
|------------------------------------|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `config-version`                   | 字符串  | 这是Velocity使用的当前配置版本。你不应该更改此设置。                                                                                                                                                                                                        |
| `bind`                             | 地址    | 这告诉代理在特定IP上接受连接。默认情况下,Velocity将在计算机上的所有IP地址上的25565端口监听连接。                                                                                                                                                           |
| `motd`                             | 聊天    | 这允许你更改当玩家将你的服务器添加到他们的服务器列表时显示的消息。你可以使用[MiniMessage格式](https://docs.advntr.dev/minimessage/format.html)。                                                                                                            |
| `show-max-players`                 | 整数    | 这允许你自定义玩家服务器列表中的"最大"玩家数。注意Velocity没有它支持的最大玩家数限制。                                                                                                                                                                     |
| `online-mode`                      | 布尔值  | 我们是否应该与Mojang验证玩家?默认情况下,这是开启的。                                                                                                                                                                                                        |
| `force-key-authentication`         | 布尔值  | 代理是否应该强制执行新的公钥安全标准?默认情况下,这是开启的。                                                                                                                                                                                               |
| `player-info-forwarding-mode`      | 枚举    | 有关更多信息,请参见[配置玩家信息转发](../getting-started/forwarding.md)。                                                                                                                                                                                    |
| `prevent-client-proxy-connections` | 布尔值  | 如果从此代理发送的客户端ISP/AS与来自Mojang认证服务器的不同,则踢出玩家。这禁止某些VPN和代理连接,但这是一种弱形式的保护。                                                                                                                                   |
| `forwarding-secret-file`           | 字符串  | 存储转发密钥的文件名。此密钥用于确保由Velocity转发的玩家信息来自你的代理,而不是来自假装运行Velocity的人。有关更多信息,请参见"玩家信息转发"部分。                                                                                                           |
| `announce-forge`                   | 布尔值  | 此设置决定Velocity是否应该将自己呈现为Forge/FML兼容服务器。默认情况下,这是禁用的。                                                                                                                                                                         |
| `kick-existing-players`            | 布尔值  | 允许恢复原版行为,在玩家尝试重新连接时踢出代理上的用户(例如,短暂失去互联网连接)。                                                                                                                                                                          |
| `ping-passthrough`                 | 字符串  | 允许从`try`列表(或强制主机服务器连接顺序)转发nothing(默认),`MODS`(用于Forge),`DESCRIPTION`,或everything(`ALL`)。                                                                                                                                            |
| `enable-player-address-logging`    | 布尔值  | 如果禁用(默认为true),日志中的玩家IP地址将被替换为`<ip address withheld>`。                                                                                                                                                                                  |

## `servers`部分

| 设置名称    | 类型    | 描述                                                                                                                |
|---------------|---------|----------------------------------------------------------------------------------------------------------------------------|
| 服务器名称    | 地址    | 这使代理知道它可以连接到的服务器。                                                                                 |
| `try`         | 数组    | 这指定了当玩家登录和从服务器被踢出时Velocity应该尝试连接的服务器。                                                |

## `forced-hosts`部分

| 设置名称   | 类型     | 描述                                                                                                                                       |
|--------------|----------|---------------------------------------------------------------------------------------------------------------------------------------------------|
| 主机名称     | 主机名   | 这配置代理为指定的主机名创建强制主机。值是要为指定主机名尝试的服务器数组。                                                               |

## `advanced`部分

| 设置名称                                | 类型    | 描述                                                                                                                                                                             |
|--------------------------------------------|---------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `compression-threshold`                    | 整数    | 这是数据包在代理压缩之前必须达到的最小大小(以字节为单位)。Minecraft默认使用256字节。                                                                                          |
| `compression-level`                        | 整数    | 此设置指示代理应该使用什么`zlib`压缩级别来压缩数据包。默认值使用默认的zlib级别。                                                                                           |
| `login-ratelimit`                          | 整数    | 此设置确定在接受来自同一IP地址的连接之前必须经过的最小时间(以毫秒为单位)。值为`0`禁用速率限制。                                                                            |
| `connection-timeout`                       | 整数    | 此设置确定代理在超时之前等待连接到服务器的时间。                                                                                                                          |
| `read-timeout`                             | 整数    | 此设置确定代理在超时之前等待从服务器接收数据的时间。                                                                                                                     |
| `haproxy-protocol`                         | 布尔值  | 此设置确定Velocity是否应该接收HAProxy PROXY消息。如果你不使用HAProxy,请保持此设置关闭。                                                                                |
| `tcp-fast-open`                            | 布尔值  | 此设置允许你在Velocity中启用TCP Fast Open支持。你的代理必须运行在Linux内核>=4.14上才能应用此设置。                                                              |
| `bungee-plugin-message-channel`            | 布尔值  | 此设置允许你启用或禁用对BungeeCord插件消息通道的支持。                                                                                                       |
| `show-ping-requests`                       | 布尔值  | 此设置允许你记录客户端发送到代理的ping请求。                                                                                                                              |
| `announce-proxy-commands`                  | 布尔值  | 此设置允许你启用或禁用显式向客户端发送代理命令(用于Minecraft 1.13+标签补全)。                                                                      |
| `failover-on-unexpected-server-disconnect` | 布尔值  | 此设置允许你确定在发生非正常断开连接时代理是应该故障转移还是断开用户连接。                                                                         |
| `log-command-executions`                   | 布尔值  | 确定代理是否应该记录用户运行的所有命令。                                                                                                                            |
| `log-player-connections`                   | 布尔值  | 启用记录玩家连接到代理、切换服务器和从代理断开连接的情况。                                                                                                 |
| `accepts-transfers`                        | 布尔值  | 确定代理是否接受来自其他服务器的传入传送。如果禁用,代理将断开传送的客户端连接。                                                          |

## `query`部分

| 设置名称      | 类型    | 描述                                                                                                  |
|----------------|---------|--------------------------------------------------------------------------------------------------------------|
| `enabled`      | 布尔值  | Velocity是否应该回复Minecraft查询协议请求。你通常可以将此保持为false。                               |
| `port`         | 数字    | 指定Velocity应该在哪个端口监听GameSpy 4(Minecraft查询协议)请求。                                      |
| `map`          | 字符串  | 指定要向客户端显示的地图名称。                                                                         |
| `show-plugins` | 布尔值  | Velocity插件是否包含在查询响应中。                                                                     |
